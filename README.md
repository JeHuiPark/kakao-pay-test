## Start Guide

MySQL, Redis 실행
``` shell
docker-compose up 
```

jar 빌드
```shell
./gradlew build
```

이미지 빌드
```shell
docker build -t jehui/kakao-pay-test .
```

~~컨테이너 실행~~  
컨테이너 네트워크 설정 누락으로 실행 불가능
```shell
docker run -p 8080:8080 jehui/kakao-pay-test
```

## 요구사항 분석

### 기능 분석
- 투자 상품의 종류는 2가지가 있다
    - 부동산 투자
    - 신용 투자

- 전체 투자 상품 조회 API
    - 입력 값 : 없음
    - 출력 값 : 상품 ID, 상품 제목, 총 모집금액, 현재 모집금액, 투자자 수, 투자모집상태, 상품 모집기간
    - 모집기간에 해당하는 상품만 응답해야 한다.
    - 투자모집상태는 2가지로 정의되어 있다.  
      이전 요구사항을 통해 모집완료 상태를 어떻게 판단할지 추론이 가능하다.  
      `모집기간에 해당하는 상품만` 이라는 전제조건이 달려있기 때문에 이 상태값을 판단할 때, 모집기간은 관심사에서 제거한다.  
      만약 `모집기간` 정보가 이 상태에 영향을 주는 정보라면 모집전 상태에 대한 정의도 요구사항에 포함이 되어있었을 것이다.
      ``` sudo
      if (품절)
        return 모집완료
      else 
        return 모집중
      ```
        - 모집중
        - 모집완료
    - 누적 투자자 (집계 데이터를 미리 생성할 것인가, 레이지 로딩할 것인가)
    - 누적 투자금액 (집계 데이터를 미리 생성할 것인가, 레이지 로딩할 것인가)
    - 중복투자에 대한 제약사항이 명시되지 않았으므로, 허용한다고 가정한다

- 투자하기 API
    - 입력 값 : 사용자 식별값, 상품 ID, 투자 금액
    - 출력 값 : 예외 처리에 대한 형식만 정의됨
    - 동시성이 고려되어야 한다.
    - 누적 투자금액은 총 모집금액을 초과할 수 없다.
    - 총 모집금액을 넘어서면 Sold Out 상태를 응답해야 한다.  
      (총 모집금액이 100만원이고, 누적 투자금액이 95만원인 상태에서 10만원을 투자할 경우 Sold Out 상태로 표현해야 하는 것인가?)
    - 사용자 정보는 `X-USER-ID` 헤더에 기술된다.
  
- 나의 투자상품 조회 API
    - 입력 값 : 사용자 식별값
    - 출럭 값 : 상품 ID, 상품 제목, 총 모집금액, 나의 투자금액, 투자일시
    - 사용자 정보는 `X-USER-ID` 헤더에 기술된다.

### 시스템 분석
- 수평확장이 가능한 서비스로 개발 되어야 한다.
- 다량의 트래픽에도 무리가 없도록 효율적으로 작성 되어야 한다.  
  (표현이 명확하지 않아서 어느 정도의 효율성을 요구하는지 유추하기 힘들다.)

## 문제해결 전략

### 집계성 데이터와 총 모집금액 

전체 투자 상품 조회 API에서 제공되는 데이터에는 크게 아래와 같은 특성을 포함한다
- 집계성 정보
    - `누적 투자자`
    - `누적 투자금액`
- 잘 변하는 정보와 잘 변하지 않는 정보
    - 모집 진행중인 상품
    - 모집 완료된 상품

일반적으로 전체 투자 상품 조회 API와 같은 기능은 실행 빈도 수가 높기 때문에 성능이 고려되어야 하는데, 
집계성 정보는 레이지 로딩으로 풀어낼 경우 시스템이 노후될 수록 성능에 악영향을 끼칠 수 있다.

그러므로, 여기서 `누적 투자자` 와 `누적 투자금액` 과 같은 속성은 조회를 위한 속성이라고 가정하고 스키마 설계에 반영이 되어야 한다.

### 투자하기

- `누적 투자금액` 속성은 투자하기 API 에서도 사용되는 사용빈도가 아주 높은 데이터이므로,  `Redis` 에서 연산을 위한 데이터로 관리해도 좋을 것이다.  
그러나, `Redis` 를 도입할 경우 발생하는 `trade off` 를 고려하여, 간단하게 RDB 에서 집계형 데이터를 따로 관리하는 전략을 선택한다
    > 이 속성은 단순히 읽기 전용 데이터가 아니며, 트랜잭션과 관련된 중요한 데이터이기 때문에 만약 레디스를 도입한다면 견고하게 설계가 되어야 한다.
    >
    > 서비스중 레디스에 장애가 생겨 데이터가 유실 되더라도 빠지더라도 최종적으로 데이터 일관성을 유지해야 하며, 서비스는 계속 유지되어야 할 것이다.
    >
    > 치명적인 약점을 내포하고 있는 시스템보다, 성능이 조금 열등하더라도 견고하게 만드는게 중요하다
- 최소 투자금액에 대한 정보가 없다 임의로 정의한다
- 한 사람이 같은 사람이 중복 투자하는 것을 허용 하지만, 투자자 집계는 1번만 하는 것으로 가정한다
- 한 사람이 근소한 시간 차이로 중복 투자를 하는 것은 매우 드문 케이스로 간주하고, RDBMS의 트랜잭션과 유니크 인덱스를 이용해서 투자자 집계 방어 로직을 작성한다

### 나의 투자상품
이 데이터는 잘 변하지 않는 속성을 가지기 때문에 캐시전략을 도입할 캐시 히트율이 아주 높은 기능이 될 것이다.  
단순 조회 기능이기 때문에 `Redis` 를 도입할 경우 발생하는 `trade off` 를 고려해도 노력대비 얻을 게 아주 많다.
